import { Card } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Textarea } from '@/components/ui/textarea';
import { Trash2, Printer } from 'lucide-react';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';
import type { PurchaseItem, Supplier, Product } from '../index';

interface PurchasePanelProps {
  purchaseItems: PurchaseItem[];
  selectedSupplier: Supplier | null;
  suppliers: Supplier[];
  notes: string;
  isLoading: boolean;
  onSupplierChange: (supplier: Supplier | null) => void;
  onRemoveItem: (productId: string) => void;
  onUpdateQuantity: (productId: string, quantity: number) => void;
  onUpdatePrice: (productId: string, price: number) => void;
  onNotesChange: (notes: string) => void;
  onSave: (shouldPrint?: boolean, printType?: 'receipt' | 'a4') => void;
  calculateTotals: () => { subtotal: number; total: number };
  isEditMode?: boolean;
}

export default function PurchasePanel({
  purchaseItems,
  selectedSupplier,
  suppliers,
  notes,
  isLoading,
  onSupplierChange,
  onRemoveItem,
  onUpdateQuantity,
  onUpdatePrice,
  onNotesChange,
  onSave,
  calculateTotals,
  isEditMode = false,
}: PurchasePanelProps) {
  const t = (key: string) => key; // Simple translation
  const totals = calculateTotals();

  return (
    <div className="grid gap-4 md:grid-cols-[2fr_1fr]">
      {/* Left Column - Items */}
      <div className="space-y-4">
        {/* Supplier Selection */}
        <Card className="p-4">
          <Label>{t('Supplier')}</Label>
          <Select
            value={selectedSupplier?._id || ''}
            onValueChange={(value) => {
              const supplier = suppliers.find((s) => s._id === value);
              onSupplierChange(supplier || null);
            }}
          >
            <SelectTrigger className="mt-2">
              <SelectValue placeholder={t('Select supplier')} />
            </SelectTrigger>
            <SelectContent>
              {suppliers.map((supplier) => (
                <SelectItem key={supplier._id} value={supplier._id}>
                  {supplier.name}
                  {supplier.phone && ` - ${supplier.phone}`}
                </SelectItem>
              ))}
            </SelectContent>
          </Select>
        </Card>

        {/* Items Table */}
        <Card className="p-4">
          <h3 className="mb-4 font-semibold">{t('Purchase Items')}</h3>
          {purchaseItems.length === 0 ? (
            <div className="py-8 text-center text-muted-foreground">
              {t('No items added yet')}
            </div>
          ) : (
            <div className="space-y-2">
              <div className="grid grid-cols-[2fr_1fr_1fr_1fr_auto] gap-2 text-sm font-medium">
                <div>{t('Product')}</div>
                <div className="text-center">{t('Quantity')}</div>
                <div className="text-right">{t('Price')}</div>
                <div className="text-right">{t('Total')}</div>
                <div></div>
              </div>

              {purchaseItems.map((item) => (
                <div
                  key={item.product._id}
                  className="grid grid-cols-[2fr_1fr_1fr_1fr_auto] gap-2 rounded-lg border p-2"
                >
                  <div className="flex flex-col">
                    <span className="font-medium">{item.product.name}</span>
                    {item.product.code && (
                      <span className="text-xs text-muted-foreground">
                        {item.product.code}
                      </span>
                    )}
                  </div>

                  <Input
                    type="number"
                    min="1"
                    value={item.quantity}
                    onChange={(e) =>
                      onUpdateQuantity(
                        item.product._id,
                        parseInt(e.target.value) || 1
                      )
                    }
                    className="text-center"
                  />

                  <Input
                    type="number"
                    min="0"
                    step="0.01"
                    value={item.purchasePrice}
                    onChange={(e) =>
                      onUpdatePrice(
                        item.product._id,
                        parseFloat(e.target.value) || 0
                      )
                    }
                    className="text-right"
                  />

                  <div className="flex items-center justify-end font-medium">
                    {(item.quantity * item.purchasePrice).toFixed(2)}
                  </div>

                  <Button
                    variant="ghost"
                    size="icon"
                    onClick={() => onRemoveItem(item.product._id)}
                  >
                    <Trash2 className="h-4 w-4 text-destructive" />
                  </Button>
                </div>
              ))}
            </div>
          )}
        </Card>

        {/* Notes */}
        <Card className="p-4">
          <Label>{t('Notes')}</Label>
          <Textarea
            value={notes}
            onChange={(e) => onNotesChange(e.target.value)}
            placeholder={t('Add notes about this purchase...')}
            className="mt-2"
            rows={3}
          />
        </Card>
      </div>

      {/* Right Column - Summary & Actions */}
      <div className="space-y-4">
        {/* Summary Card */}
        <Card className="p-4">
          <h3 className="mb-4 font-semibold">{t('Summary')}</h3>
          <div className="space-y-3">
            <div className="flex justify-between text-sm">
              <span className="text-muted-foreground">{t('Items')}</span>
              <span className="font-medium">{purchaseItems.length}</span>
            </div>

            <div className="flex justify-between text-sm">
              <span className="text-muted-foreground">{t('Quantity')}</span>
              <span className="font-medium">
                {purchaseItems.reduce((sum, item) => sum + item.quantity, 0)}
              </span>
            </div>

            <div className="border-t pt-3">
              <div className="flex justify-between">
                <span className="font-semibold">{t('Total')}</span>
                <span className="text-lg font-bold">
                  {totals.total.toFixed(2)} {t('currency')}
                </span>
              </div>
            </div>
          </div>
        </Card>

        {/* Actions Card */}
        <Card className="p-4">
          <div className="space-y-2">
            <Button
              className="w-full"
              onClick={() => onSave(false)}
              disabled={isLoading || !selectedSupplier || purchaseItems.length === 0}
            >
              {isLoading ? t('Saving...') : isEditMode ? t('Update') : t('Save')}
            </Button>

            <Button
              className="w-full"
              variant="outline"
              onClick={() => onSave(true, 'receipt')}
              disabled={isLoading || !selectedSupplier || purchaseItems.length === 0}
            >
              <Printer className="mr-2 h-4 w-4" />
              {t('Save & Print Receipt')}
            </Button>

            <Button
              className="w-full"
              variant="outline"
              onClick={() => onSave(true, 'a4')}
              disabled={isLoading || !selectedSupplier || purchaseItems.length === 0}
            >
              <Printer className="mr-2 h-4 w-4" />
              {t('Save & Print A4')}
            </Button>
          </div>
        </Card>

        {/* Selected Supplier Info */}
        {selectedSupplier && (
          <Card className="p-4">
            <h3 className="mb-2 font-semibold">{t('Supplier Details')}</h3>
            <div className="space-y-1 text-sm">
              <p className="font-medium">{selectedSupplier.name}</p>
              {selectedSupplier.phone && (
                <p className="text-muted-foreground">{selectedSupplier.phone}</p>
              )}
              {selectedSupplier.email && (
                <p className="text-muted-foreground">{selectedSupplier.email}</p>
              )}
              {selectedSupplier.address && (
                <p className="text-muted-foreground">{selectedSupplier.address}</p>
              )}
            </div>
          </Card>
        )}
      </div>
    </div>
  );
}
